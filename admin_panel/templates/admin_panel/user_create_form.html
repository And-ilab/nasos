{% extends "base/layout.html" %}

{% block title %}–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
    <div class="form-container"
         style="max-width: 400px; padding: 30px; background-color: rgba(255, 255, 255, 0.9); border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);">
        <h2 class="text-center mb-4">–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

        {% if messages_success %}
        <div class="alert alert-success">
            {% for message in messages_success %}
            {{ message }}
            {% endfor %}
        </div>
        {% endif %}

        <form method="post" id="userForm">
            {% csrf_token %}
            <div class="mb-3">
                {{ form.id.label }}
                {{ form.id }}
            </div>
            <div class="mb-3">
                {{ form.last_name.label }}
                {{ form.last_name }}
            </div>
            <div class="mb-3">
                {{ form.first_name.label }}
                {{ form.first_name }}
            </div>
            <div class="mb-3">
                {{ form.middle_name.label }}
                {{ form.middle_name }}
            </div>

            <div class="mb-3">
                {{ form.role.label }}
                {{ form.role }}
            </div>
            <div class="mb-3" id="groupField">
                {{ form.group_number.label }}
                {{ form.group_number }}
            </div>
            <div class="mb-3">
                {{ form.date_of_the_test.label }}
                {{ form.date_of_the_test }}
            </div>



            <div class="text-center">
                <button type="submit" class="btn btn-primary mt-3" style="width: 100%;">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </form>
        <div class="text-center mt-4">
            <a href="{% url 'admin_panel:user_list' %}" class="btn btn-secondary" style="width: 100%;">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
        </div>
    </div>
</div>

{% if email_exists %}
<!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏ Bootstrap -->
<div class="modal fade show" id="emailErrorModal" tabindex="-1" role="dialog" aria-labelledby="emailErrorModalLabel" style="display: block; background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="emailErrorModalLabel">–û—à–∏–±–∫–∞</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∞–¥—Ä–µ—Å–æ–º —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã "{{ email }}" —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('id_password');
        const toggleIcon = document.getElementById('toggleIcon');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
        }
    }

    function toggleGroupField() {
        const roleSelect = document.getElementById('id_role');
        const groupField = document.getElementById('groupField');
        if (roleSelect.value === 'student') {
            groupField.style.display = 'block';
        } else {
            groupField.style.display = 'none';
        }
    }

    $(document).ready(function() {
        {% if email_exists %}
        $('#emailErrorModal').modal('show');
        {% endif %}

        // üîß –≤—ã–∑—ã–≤–∞–µ–º –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ "–≥—Ä—É–ø–ø—ã"
        toggleGroupField();
        document.getElementById('id_role').addEventListener('change', toggleGroupField);
    });
</script>

{% endblock %}