{% extends "base/layout.html" %}

{% block title %}Прохождение теста{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Режим обучение</h2>

    <div style="width: 100%; height: 600px;" id="viewer"></div>
</div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
import { MTLLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/MTLLoader.js';
import { OBJLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/OBJLoader.js';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xeeeeee);  // Фон

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / 600, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, 600);
    document.getElementById("viewer").appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    camera.position.set(0, 1, 5);
    controls.update();

    // Освещение
    const light = new THREE.AmbientLight(0xffffff, 1.5);
    scene.add(light);
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Загрузка модели
    const mtlLoader = new MTLLoader();
    mtlLoader.setPath('/static/admin_panel/models/');
    mtlLoader.load('main_scene.mtl', (materials) => {
        materials.preload();
        const objLoader = new OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('/static/admin_panel/models/');
        objLoader.load('main_scene.obj', (object) => {
            console.log("Модель загружена");
            scene.add(object);

            // Центрирование модели
            const box = new THREE.Box3().setFromObject(object);
            const center = box.getCenter(new THREE.Vector3());
            object.position.sub(center);
            camera.lookAt(center);
        }, undefined, (error) => {
            console.error("Ошибка загрузки модели:", error);
        });
    });

    // Реакция на изменение размера окна
    window.addEventListener('resize', () => {
        const width = document.getElementById("viewer").clientWidth;
        renderer.setSize(width, 600);
        camera.aspect = width / 600;
        camera.updateProjectionMatrix();
    });

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }

    animate();
</script>

{% endblock %}
